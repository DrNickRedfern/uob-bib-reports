---
params:
  data_date: !expr blogdown::read_toml('bibliometric_report_params.toml')$project$date
  project_name: !expr blogdown::read_toml('bibliometric_report_params.toml')$project$name
  research_unit: !expr blogdown::read_toml('bibliometric_report_params.toml')$unit$research_unit
  min_year: !expr blogdown::read_toml('bibliometric_report_params.toml')$years$minimum
  max_year: !expr blogdown::read_toml('bibliometric_report_params.toml')$years$maximum
  palette: !expr blogdown::read_toml('bibliometric_report_params.toml')$look$palette
  output_file_name: "`r paste0(params$project_name, '_bibliometric_report_', format(Sys.time(), '%Y_%m_%d'))`"
title: "`r params$research_unit`"
subtitle: 
  "`r glue::glue('Bibliometric report: {params$min_year} - {params$max_year}')`"
author: "Research and Innovation Services"
date: "`r format(Sys.time(), '%d %B %Y')`"
header-includes:
  - \usepackage{awesomebox}
  - \usepackage[none]{hyphenat}
  - \usepackage{fontspec}
mainfont: Arial
sansfont: Arial
fontsize: 11pt
output:
  bookdown::pdf_document2:
     latex_engine: xelatex
     template: eisvogel.latex
titlepage: true
titlepage-color: "`r stringr::str_sub(RColorBrewer::brewer.pal(n = 9, params$palette)[9], -6)`"
titlepage-text-color: "FFFFFF"
titlepage-rule-color: "FFFFFF"
titlepage-rule-height: 2
titlepage-logo: "university_of_bradford_white_logo.png"
logo-width: 70mm
toc: true
toc-own-page: true
colorlinks: true
bibliography: bibliography.bib
nocite: '@*'
csl: apa_mod_nr.csl
knit: |
  rmdmatter::renaming_renderer(function(metadata) {
    with(metadata, params$output_file_name)})
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
options(tinytex.engine_args="-shell-escape")
```

```{r load-packages}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(glue, here, ggpubr, ggrepel, tidyquant, tidyverse)

if(!require(rmdmatter)) remotes::install_github("mikmart/rmdmatter")
```

```{r reload-params}
# This is required to pass params as values to external functions for plotting
min_year <- params$min_year
max_year <- params$max_year
```

```{r load-data}
researchers <- read_csv(here("data", glue("{params$project_name}_researchers.csv")), 
                        show_col_types = FALSE)
df_publications <- read_csv(here("data", glue("{params$project_name}_publications_details.csv")), 
                   show_col_types = FALSE) %>%
  filter(type != "preprint") %>%
  mutate(current_affiliation = VLOOKUP(researcher_id, researchers, researcher_id, current_research_org.name))
```

```{r source-functions}
source(here("source_files", "rais_bibliometric_report_functions_general.R"))
source(here("source_files", "rais_bibliometric_report_functions_researchers.R"))
source(here("source_files", "rais_bibliometric_report_functions_outputs.R"))
source(here("source_files", "rais_bibliometric_report_functions_impact.R"))
source(here("source_files", "rais_bibliometric_report_functions_collaboration.R"))
source(here("source_files", "rais_bibliometric_report_functions_altmetrics.R"))
```

```{r set-palettes}
discrete_pal <- RColorBrewer::brewer.pal(n = 9, params$palette)
continuous_pal <- colorRampPalette(discrete_pal)
```

```{r source-set-theme}
source(here("source_files", "my_theme.R"))
```

# About this report

This report presents a summary-level bibliometric analysis of outputs produced by researchers in `r params$research_unit` that were published from `r params$min_year` to `r params$max_year`, and includes basic bibliometric information, citation data and impact metrics, open access data, collaboration data, and Altmetrics.

\begin{importantblock}
This report presents quantitative analyses of bibliometric data that can be used to evaluate research units. However, the limitations of bibliometric analysis mean that bibliometrics should never be used as the sole criteria for any evaluation purposes. Quantitative indicators should always be used to supplement qualitative peer assessment of research quality and impact. Research should always be assessed on its own merits against the strategic goals set out in the University of Bradford’s research and innovation strategy and the objectives of the researchers and the university’s external research partners.
\end{importantblock}

## Data
The bibliometric analysis is based on data obtained from the [Dimensions](https://app.dimensions.ai) database. The data was exported from Dimensions on `r params$data_date`.

The result set includes all research outputs from `r params$research_unit` *published* from `r params$min_year` to `r params$max_year`. Please note that this does *not* include preprints.

\newpage

# Researchers

```{r data-researchers}
researchers_result <- researchers_summary(researchers)

n_researchers_in_results <- researchers_result$n_researchers_in_results[1]
  
n_currently_affiliated_researchers <- researchers_result$n_currently_affiliated_researchers[1]

n_researchers_without_orcid <- researchers_result$n_researchers_without_orcid[1]

n_researchers_with_orcid <- researchers_result$n_researchers_with_orcid[1]

p_researchers_with_orcid <- researchers_result$p_researchers_with_orcid[1]

n_researchers_with_outputs <- n_distinct(df_publications$full_name)
```

This section presents on overview of the researchers in `r params$research_unit` included in the result set. Only researchers with a disambiguated Dimensions researcher id are included. Researchers in the result set with multiple Dimensions researcher ids have been aggregated under the id associated with the greatest academic age.

## Key stats

```{r fig-researcher-stats, fig.align='center'}
researchers_key_stats <- tibble(
  x = c(2, 8.5, 2, 8.5),
  y = c(11, 11, 6.5, 6.5),
  h = c(4.25, 4.25, 4.25, 4.25),
  w = c(6.25, 6.25, 6.25, 6.25),
  values = as.character(c(n_researchers_in_results,
                          n_currently_affiliated_researchers,
                          n_researchers_with_outputs,
                          p_researchers_with_orcid)),
  text = c("Researchers with\nDimensions ids",
           "Currently affiliated\nresearchers*",
           "Researchers with at\nleast one output",
           "Researchers\nwith an ORCiD id"),
  colour = factor(c(1, 2, 3, 4))) %>%
  mutate(values = ifelse(text %in% text[4],
                         glue("{values}%"),
                         values))

key_stats_plot(researchers_key_stats, discrete_pal) + 
  labs(caption = str_wrap("* Currently affiliated researchers are defined as researchers whose researcher id is matched to the University of Bradford's organisation id at the time the result set was generated.", width = 80))
```

\newpage

## Researchers with outputs published `r params$min_year` to `r params$max_year`

From `r params$min_year` to `r params$max_year`, `r n_researchers_with_outputs` researchers in the `r params$research_unit` published at least one research output. Table \@ref(tab:tbl-researchers-outputs) presents the number of outputs for each researcher by year.

\begin{cautionblock}
The list of contributing authors in Table @ref(tab:tbl-researchers-outputs) reflects only those researchers who are present in the Dimensions result set. Other members of staff in the `r params$research_unit` may be actively engaged in research and knowledge exchange activities that are not recorded by Dimensions and their absence from Table @ref(tab:tbl-researchers-outputs) should not necessarily be interpreted as a lack of research activity.
\end{cautionblock}

```{r tbl-researchers-outputs}
df_researcher_outputs <- researchers_outputs(df_publications)

# Display the table
knitr::kable(df_researcher_outputs, format = "latex", longtable = TRUE,
             align = c("l", rep("c", dim(df_researcher_outputs)[2])), 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Annual number of outputs for researchers in the {params$research_unit}. Publications with multiple authors from the University of Bradford are counted once for each author.")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position", "repeat_header")) %>%
  kableExtra::column_spec(1, width = "16em")

```

\begin{warningblock}
The number of outputs of a researcher is affected by contract type, teaching workload, career stage, gender, personal interests, and other factors. None of these factors are captured by reporting the number of outputs produced by a researcher and the data should be interpreted with care to avoid bias.
\end{warningblock}

\newpage

## Academic age

```{r academic-age}
researchers <- researchers %>%
  mutate(age_bin = cut(academic_age, breaks = c(0, 1, seq(5, 50, 5))),
         total_publications = VLOOKUP(full_name, df_researcher_outputs, Researcher, Total))

academic_age_result <- academic_age_summary(researchers)

mean_academic_age <- academic_age_result$mean_academic_age[1]
median_academic_age <- academic_age_result$median_academic_age[1]
p_younger_than_eleven <- academic_age_result$p_younger_than_eleven[1]
academic_age <- academic_age_result$academic_age
```

A researcher's academic age is defined as *the number of years elapsed since the year publication of their first output*.

For researchers in `r params$research_unit` who have published at least one output since `r params$min_year`, the mean academic age is **`r mean_academic_age` years**, the median academic age is **`r median_academic_age` years**, and **`r p_younger_than_eleven`%** have an academic age less than or equal to ten years. Figure \@ref(fig:fig-academic-age) plots the distribution of the academic ages of researchers who published at least one output published between `r params$min_year` and `r params$max_year`.

\smallskip

```{r fig-academic-age, fig.align='center', fig.pos='H', fig.width = 6, fig.cap = glue("Academic age distribution of researchers in the {params$research_unit} who publsihed at least one research output published between {params$min_year} and {params$max_year}.")}
academic_age_plot(academic_age, discrete_pal)
```

\newpage

# Outputs

This section presents a descriptive overview of the research outputs of the `r params$research_unit` published form `r params$min_year` to `r params$max_year`.

```{r data-outputs}
publications_results <- publications_summary(df_publications)

n_unique_outputs <- publications_results$n_unique_outputs[1]
n_outputs_currently_affiliated <- publications_results$n_outputs_currently_affiliated[1]
df_outputs_by_type <- publications_results$df_outputs_by_type
df_output_volume <- publications_results$df_output_volume
df_output_growth <- publications_results$df_output_growth
p_increase_outputs <- publications_results$p_increase_outputs[1]
```

```{r data-open-access}
open_access_results <- open_access_summary(df_publications)

open_access_data <- open_access_results$open_access_data
open_access_count <- open_access_results$open_access_count
p_open_access <- open_access_results$p_open_access
p_closed_open_access <- open_access_results$p_closed_open_access
p_gold_open_access <- open_access_results$p_gold_open_access
```

## Key stats

```{r fig-outputs-stats, fig.align='center'}
outputs_key_stats <- tibble(
  x = c(2, 8.5, 2, 8.5),
  y = c(11, 11, 6.5, 6.5),
  h = c(4.25, 4.25, 4.25, 4.25),
  w = c(6.25, 6.25, 6.25, 6.25),
  values = as.character(c(n_unique_outputs,
                          n_outputs_currently_affiliated,
                          round(p_increase_outputs, 0),
                          round(p_open_access, 0))),
  text = c("Total research outputs\n",
           "Outputs by currently\naffiliated researchers",
           glue("Relative change in\noutputs, {params$min_year} - {params$max_year}"),
           "Open access\njournal articles*"),
  colour = factor(c(1, 2, 3, 4))) %>%
  mutate(values = ifelse(text %in% text[3:4],
                         glue("{values}%"), 
                         values))

key_stats_plot(outputs_key_stats, discrete_pal) +
  labs(caption = str_wrap("Open access refers to journal articles only. In the future open access requirements will apply to all type of research outputs and the metric will be updated once this change is implemented.", width = 80)) 
```

## Overview

Figure \@ref(fig:fig-output-cumulative) plots the cumulative growth in the total number of outputs over time and Figure \@ref(fig:fig-output-volume) plots the outputs by all researchers in Table \@ref(tab:tbl-researchers-outputs) by output type. Figure \@ref(fig:fig-output-change) shows the annual percentage change in the number of outputs. Figure \@ref(fig:fig-output-affiliated) plots the total number of outputs published each year by researchers currently affiliated to the University of Bradford. There are `r n_outputs_currently_affiliated` outputs by researchers currently affiliated to the university.

```{r fig-output-cumulative, fig.align='center', fig.pos='H', fig.width = 6, fig.height = 3.5, fig.cap = glue("Cumualtive growth in research outputs produced by the {params$research_unit}, {params$min_year} - {params$max_year}.")}
chart_cumulative_growth(df_output_growth, discrete_pal, min_year, max_year)
```

\bigskip

```{r fig-output-change, fig.align='center', fig.pos='H', fig.width = 6, fig.height = 3.5, fig.cap = glue("Annual percentage change in research outputs produced by the {params$research_unit}, {params$min_year} - {params$max_year}.")}
chart_percentage_change(df_output_growth, discrete_pal, min_year, max_year)
```

\newpage

```{r fig-output-volume, fig.align='center', fig.pos='H', fig.width = 6, fig.height = 3.5, fig.cap = glue("Research outputs produced by the {params$research_unit}, {params$min_year} - {params$max_year}.")}
chart_output_volume(df_output_volume, discrete_pal, min_year, max_year)
```

\bigskip

```{r fig-output-affiliated, fig.align='center', fig.pos='H', fig.width = 6, fig.height = 3.5, fig.cap = glue("Research outputs produced researchers in the {params$research_unit} who are currently affiliated to the University of Bradford, {params$min_year} - {params$max_year}.")}
chart_output_affiliated(df_publications, discrete_pal, min_year, max_year)
```

\newpage

## Open Access

Figure \@ref(fig:fig-open-access) shows that `r p_open_access`% of articles produced by the `r params$research_unit` are open access.

\bigskip

```{r fig-open-access, fig.align='center', fig.width = 5, fig.pos='H', fig.cap = glue("Percentage of research outputs by type of open access for the {params$research_unit}, {params$min_year} - {params$max_year}. Please note: data is limited to articles only.")}
open_access_donut(open_access_count, discrete_pal)
```

\newpage

## Where was research published?

```{r data-journals}
where_published_results <- where_published_summary(df_publications, discrete_pal)

n_journals <- where_published_results$n_journals[1]
```

Researchers in the `r params$research_unit` published journal articles in `r n_journals` journals. Table \@ref(tab:tbl-journals) breaks down the number of journal articles by researchers in the `r params$research_unit` by venue of publication, showing only those journals which published more than one article. Figure \@ref(fig:fig-outputs-publishers) shows the publishers of the journal articles.

```{r tbl-journals}
df_journals_count <- where_published_results$df_journals_count

knitr::kable(df_journals_count, align = "cl", 
             booktabs = TRUE, linesep = "\\addlinespace", longtable = TRUE,
             caption = glue("Number of outputs for the top venues of publication for outputs produced by researchers from the {params$research_unit}, {params$min_year} to {params$max_year}. Plesae note: not all reseaarch outputs listed in Dimensions have an identified venue of publication (e.g., monographs and conference proceedings.)")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position", "repeat_header")) %>%
  kableExtra::column_spec(2, width = "40em")
```

```{r fig-outputs-publishers, fig.align='center', fig.width=6, fig.height=8, fig.pos='H', fig.cap=glue("Publishers of journal articles produced by researchers in the {params$research_unit}, {params$min_year} - {params$max_year}.")}
where_published_results$publishers_plot
```

\newpage

## Research areas

Dimensions allocates a range of identifiers to research outputs using [machine learning based on peer review](https://plus.dimensions.ai/support/solutions/articles/23000018820-which-research-categories-and-classification-schemes-are-available-in-dimensions-) to identify the research areas to which those outputs belong.

### Fields of Research (ANZSRC2020)

The [Australian and New Zealand Standard Research Classification 2020](https://www.abs.gov.au/statistics/classifications/australian-and-new-zealand-standard-research-classification-anzsrc/latest-release) for fields of research (FoR 2020) is a hierarchical system of classifying areas of research, with major fields of research divided into minor fields. Fields are placed into categories with which they share a common methodology. 

The allocation of a research output to multiple FoRs is a low-level indicator of multi- or interdisciplinary research. Dimensions allocates research to FoRs at two levels: 1st Level FoRs that share a broad methodology, knowledge, and/or perspective with other research outputs; and 2nd Level FoRs that divide the 1st Level FoRs into sub-disciplines. This section of the report focuses on 1st Level FoRs only.

```{r data-for2020}
df_for_2020 <- read_csv(here("data",  glue("{params$project_name}_publications_for_2020.csv")), 
                        show_col_types = FALSE) %>%
  filter(type != "preprint") %>%
  mutate(level = ifelse(nchar(for_2020_code) == 2, "level_1", "level_2"))

for_2020_summary_results <- for_2020_summary(df_for_2020)

outputs_with_no_for <- for_2020_summary_results$outputs_with_no_for
n_unique_for <- for_2020_summary_results$n_unique_for
for_level_1_summary <- for_2020_summary_results$for_level_1_summary
for_2020_level_1_per_publication <- for_2020_summary_results$for_2020_level_1_per_publication
n_outputs_with_single_level_1_for <- for_2020_summary_results$n_outputs_with_single_level_1_for
p_outputs_with_single_level_1_for <- for_2020_summary_results$p_outputs_with_single_level_1_for
n_outputs_with_multi_level_1_for <- for_2020_summary_results$n_outputs_with_multi_level_1_for
p_outputs_with_multi_level_1_for <- for_2020_summary_results$p_outputs_with_multi_level_1_for

source(here("source_files", "numbers2words.R"))
no_for_text <- ifelse(outputs_with_no_for == 1,
                      glue::glue("is {numbers2words(outputs_with_no_for)} research output that has"),
                      glue::glue("are {numbers2words(outputs_with_no_for)} research outputs that have"))
```

Of the research outputs in the result set, **`r n_outputs_with_single_level_1_for` (`r p_outputs_with_single_level_1_for`%)** are allocated a single 1st Level Field of Research and **`r n_outputs_with_multi_level_1_for` (`r p_outputs_with_multi_level_1_for`%)** are allocated to multiple 1st Level FoRs. There `r no_for_text` not been allocated a 1st Level FoR category. 

A total of `r n_unique_for` 1st Level Fields of Research are allocated to research outputs from the `r params$research_unit`. Table \@ref(tab:tbl-for) shows the frequency with which different 1st Level FoRs occur.

```{r tbl-for}
knitr::kable(for_level_1_summary, align = "lcc", 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Number of outputs for the {params$research_unit} allocated to 1st Level Fields of Research (ANZSRC2020). Please note: an output may be assigned to more than one FoR.")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position"))
```

\newpage

### REF2021 Units of Assessment

```{r data-uoa}
df_uoa <- read_csv(here("data", glue("{params$project_name}_publications_uoa.csv")),
                   show_col_types = FALSE)

uoa_summary_results <- uoa_summary(df_uoa)
outputs_with_no_uoa <- uoa_summary_results$outputs_with_no_uoa
n_units_of_assessment <- uoa_summary_results$n_units_of_assessment
uoas_per_publication <- uoa_summary_results$uoas_per_publication
np_one_uoa <- uoa_summary_results$np_one_uoa
uoa_summary <- uoa_summary_results$uoa_summary
```

Research outputs from the `r params$research_unit` are allocated to **`r n_units_of_assessment`** distinct units of assessment (UoA) based on the classification system used in the [2021 REF](https://www.ref.ac.uk). Table \@ref(tab:tbl-uoa) summarises the number of articles allocated to each unit of assessment. **`r np_one_uoa$n` (`r np_one_uoa$percent`%)** of outputs are allocated to a single UoA. There are `r outputs_with_no_uoa` outputs that have not been allocated a unit of assessment. 

```{r tbl-uoa}
knitr::kable(uoa_summary, align = "lcc", 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Number of outputs for the {params$research_unit} allocated to units of assessment based on REF 2021. Plesae note: an output may be assigned to more than one unit of assessment.")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position")) %>%
  kableExtra::column_spec(1, width = "30em")
```

\newpage

### Medical Subject Headings (MeSH)

```{r data-mesh-terms}
df_mesh <- read_csv(here("data", glue("{params$project_name}_publications_mesh.csv")),
                    show_col_types = FALSE)

mesh_summary_results <- mesh_summary(df_mesh)
outputs_with_at_least_one_mesh_term <- mesh_summary_results$outputs_with_at_least_one_mesh_term
n_unique_mesh_terms <- mesh_summary_results$n_unique_mesh_terms
outputs_with_no_mesh_term <- mesh_summary_results$outputs_with_no_mesh_term
top_k_mesh_terms <- mesh_summary_results$top_k_mesh_terms
```

[Medical Subject Headings](https://www.ncbi.nlm.nih.gov/mesh/) (MeSH) is the NLM controlled vocabulary thesaurus used for indexing articles for PubMed.

A total of **`r outputs_with_at_least_one_mesh_term` outputs** in the result set are allocated at least one MeSH category, with **`r n_unique_mesh_terms` unique terms** used across these outputs. There are `r outputs_with_no_mesh_term` outputs that have not been allocated at least one MeSH term. Table \@ref(tab:tbl-mesh) plots the MeSH terms that account for at least 1% of the unique terms.

```{r tbl-mesh}
knitr::kable(top_k_mesh_terms, align = "lcc", 
             booktabs = TRUE, #linesep = "\\addlinespace",
             caption = glue("The top {mesh_summary_results$k} occuring MeSH terms for research produced by the {params$research_unit}, {params$min_year} to {params$max_year}.")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position")) #%>%
  #kableExtra::column_spec(1, width = "20em")
```

\newpage

### Research, Condition, and Disease Categorization (RCDC)

```{r data-rcdc}
df_rcdc <- read_csv(here("data", glue("{params$project_name}_publications_rcdc.csv")),
                    show_col_types = FALSE)

rcdc_summary_results <- rcdc_summary(df_rcdc, p = 1)
outputs_with_at_least_one_rcdc <- rcdc_summary_results$outputs_with_at_least_one_rcdc
outputs_with_no_rcdc <- rcdc_summary_results$outputs_with_no_rcdc
n_unique_rcdc <- rcdc_summary_results$n_unique_rcdc
top_k_rcdc <- rcdc_summary_results$top_k_rcdc
```

The [Research, Condition, and Disease Categorization](https://report.nih.gov/funding/categorical-spending/rcdc-process) (RCDC) system is used by the National Institutes of Health and is a biomedical classification system consisting of 237 categories. Of the research outputs in the result set, **`r outputs_with_at_least_one_rcdc`** are allocated at least one RCDC category, with **`r n_unique_rcdc` unique categories** used across all research outputs. Table \@ref(tab:tbl-rcdc) presents those RCDC categories which account for at least `r rcdc_summary_results$p` of the total categories.

```{r tbl-rcdc}
knitr::kable(top_k_rcdc, align = "lcc", 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Research, Condition, and Disease Categories accounting for at least {rcdc_summary_results$p} per cent of the total categories assigned to research outputs produced by the {params$research_unit}, {params$min_year} to {params$max_year}.")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position")) %>%
  kableExtra::column_spec(1, width = "30em")
```

\newpage

### Sustainable Devleopment Goals

The Dimensions database classifies research outputs based on the seventeen Sustainable Development Goals set out by the United Nations in the [2030 Agenda for Sustainable Development](https://sdgs.un.org/2030agenda).

```{r data-sdg}
df_sdg <- read_csv(here("data", glue("{params$project_name}_publications_sdg.csv")),
                   show_col_types = FALSE)

sdg_summary_results <- sdg_summary(df_sdg)
outputs_with_at_least_one_sdg <-sdg_summary_results$outputs_with_at_least_one_sdg
outputs_with_no_sdg <- sdg_summary_results$outputs_with_no_sdg
p_with_at_least_one_sdg <- sdg_summary_results$p_with_at_least_one_sdg
n_unique_sdg <- sdg_summary_results$n_unique_sdg
sdgs_per_publication <- sdg_summary_results$sdgs_per_publication
n_with_multi_sdgs <- sdg_summary_results$n_with_multi_sdgs
sdg_summary <- sdg_summary_results$sdg_summary
```

A total of **`r outputs_with_at_least_one_sdg` (`r p_with_at_least_one_sdg`%) outputs** in the result set are classified as associated with a Sustainable Development Goal. There are **`r n_with_multi_sdgs` outputs** associated with multiple SDGs. Research outputs from the `r params$research_unit` are associated with **`r n_unique_sdg` distinct SDGs** and Table \@ref(tab:tbl-sdg) presents the number of outputs associated with each of the relevant SDGs.

```{r tbl-sdg}
knitr::kable(sdg_summary, align = "lcc", 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Research outputs produced by the {params$research_unit}, {params$min_year} to {params$max_year}, classified according to Sustainable Devleopment Goals. Please note that some outputs may be asociated with mutltiple SDGs")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position"))
```

\newpage

# Impact

```{r data-impact}
df_citations <- df_publications %>%
  select(publication_id, open_access, year, times_cited, field_citation_ratio) %>%
  distinct(publication_id, open_access, year, times_cited, field_citation_ratio) %>%
  mutate(open_access = str_to_title(open_access))

impact_summary_results <- impact_summary(df_citations)

n_distinct_outputs <- impact_summary_results$n_distinct_outputs
total_citations <- impact_summary_results$total_citations
n_cited_outputs <- impact_summary_results$n_cited_outputs
n_uncited_outputs <- impact_summary_results$n_uncited_outputs
p_uncited_outputs <- impact_summary_results$p_uncited_outputs
p_cited_outputs <- impact_summary_results$p_cited_outputs
i_10_index_by_year <- impact_summary_results$i_10_index_by_year
i_10_index_overall <- impact_summary_results$i_10_index_overall
p_i_10_index_overall <- impact_summary_results$p_i_10_index_overall
```

```{r data-fcr}
fcr_summary_results <- fcr_summary(df_citations)

fcr_class_summary <- fcr_summary_results$fcr_class_summary
n_outputs_with_fcr <- fcr_summary_results$n_outputs_with_fcr
n_uncited <- fcr_summary_results$n_uncited
p_uncited <- fcr_summary_results$p_uncited
n_below_average <- fcr_summary_results$n_below_average
p_below_average <- fcr_summary_results$p_below_average
n_above_average <- fcr_summary_results$n_above_average
p_above_average <- fcr_summary_results$p_above_average
median_fcr <- fcr_summary_results$median_fcr
fcr_overall_geomean <- fcr_summary_results$fcr_overall_geomean
```

The result set used in this report covers the time period `r params$min_year` to `r params$max_year`. This is a limited time frame for outputs to accumulate citations and some research metrics, such as the Field Citation Ratio, require two years to have elapsed since publication in order to be calculated and are therefore only available for some outputs in the result set.

## Key stats

```{r fig-impact-stats, fig.align='center'}
impact_key_stats <- tibble(
  x = c(2, 8.5, 2, 8.5),
  y = c(11, 11, 6.5, 6.5),
  h = c(4.25, 4.25, 4.25, 4.25),
  w = c(6.25, 6.25, 6.25, 6.25),
  values = as.character(c(n_cited_outputs,
                          total_citations,
                          p_uncited_outputs,
                          round(p_above_average, 0))),
  text = c("Outputs with at least\none citation",
           glue("Total citations,\n{params$min_year} - {params$max_year}"),
           glue("Uncited outputs\n"),
           "Outputs with FCR > 1*\n"),
  colour = factor(c(1, 2, 3, 4))) %>%
  mutate(values = ifelse(text %in% text[3:4],
                         glue("{values}%"), 
                         values))

key_stats_plot(impact_key_stats, discrete_pal) +
  labs(caption = str_wrap("* Of those outputs that have a Field Citation Ratio.", width = 80)) 
```

\newpage

## Citations

The `r n_distinct_outputs` outputs in the result set received a total of `r total_citations` citations since `r params$min_year`. Of the outputs in the result set, `r n_cited_outputs` (`r p_cited_outputs`%) have at least one citation.

Table \@ref(tab:tbl-citations) shows the total number of citations received by research outputs produced by the `r params$research_unit` by year of publication, along with the mean and median citations per output and the i-10 index.

```{r tbl-citations}
citations_by_year <- citations_summary(df_citations, i_10_index_by_year)
outputs_over_two_years_old <- sum(citations_by_year$Outputs[citations_by_year$Year < (max_year - 1)])

knitr::kable(citations_by_year, align = rep("c", dim(citations_by_year)[2]), 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Total and average citations by year of publication for research outputs produced by the {params$research_unit}, {params$min_year} - {params$max_year}.")) %>%
  kableExtra::kable_styling(font_size = 10, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position"))
```

The i-10 index indicates the number of academic publications that have been cited by at least 10 sources. For the `r params$research_unit` data, the overall i-10 index is `r i_10_index_overall`, with **`r p_i_10_index_overall`%** or outputs receiving at least 10 citations.

\newpage

## Field Citation Ratio

The Field Citation Ratio (FCR) is a citation-based measure of the *relative* scientific influence of a research output when compared to similarly-aged outputs in the same field of research. It is calculated as the ratio of the number of citations of an output to the average number of citations received by outputs of the *same type published in the same year and in the same fields of research*. An FCR greater than 1.0 indicates that an output has more citations than average: for example, an output with an FCR of 1.5 has 50% more citations than average compared to similar outputs. An FCR of less than 1.0 indicates an output has fewer citations than average: for example, an output with an FCR of 0.75 has 25% fewer citations compared to similar outputs. Given the time frame covered by this report, Field Citation Ratios are only available for outputs published in `r params$max_year-2` or earlier.

Of the `r outputs_over_two_years_old` research outputs that are at least two years old included in the result set, `r n_outputs_with_fcr` have a Field Citation Ratio. Of those research outputs within an FCR, `r n_uncited` (`r p_uncited`%) are uncited and have an FCR of zero, and `r n_below_average` (`r p_below_average`%) are below average. **`r n_above_average` (`r p_above_average`%)** of outputs perform better than average when compared to similar outputs. 
Figure \@ref(fig:fig-fcr) plots the distribution of FCR scores for `r params$research_unit`. The FCR scores range from `r fcr_summary_results$range_fcr[1]` to `r fcr_summary_results$range_fcr[2]`, with a median FCR score of **`r median_fcr`**. The geometric mean FCR score is **`r fcr_overall_geomean`**.

\bigskip

```{r fig-fcr, fig.width = 6, fig.height=3.5, fig.pos="H", fig.cap=glue("The distribution of Field Citation Ratio scores for research outputs (n = {n_outputs_with_fcr}) published by the {params$research_unit} in {params$min_year}.")}
fcr_box_plot(open_access_data, discrete_pal)
```

\newpage

## Citations of open access articles

Limiting research outputs to *articles* only, Table \@ref(tab:tbl-oa-impact) shows that Gold, Green, and Hybrid open access articles tend to perform better than those that use the Bronze model and non-open access articles. The mean number of citations is potentially misleading due to the sensitivity of this statistic to outlying data points, with a single highly-cited output able to make the mean value unrepresentative of the data. The median number of citations and the geometric mean of the FCR scores are resistant to these effects and are preferred when interpreting these results.

```{r tbl-oa-impact}
open_access_citation_results <- open_access_citations(open_access_data)

knitr::kable(open_access_citation_results, 
             align = c("l", rep("c", dim(open_access_citation_results)[2]-1)), 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Average citations by open access for articles published by the {params$research_unit}, {params$min_year} - {params$max_year}. Please note: the geometric means of the Field Citation Ratios are based on data for {params$min_year} only.")) %>%
  kableExtra::kable_styling(font_size = 9, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position")) %>%
  kableExtra::column_spec(2:7, width = "5em")
```

\newpage

## Where was research cited?

```{r load-citing-publications}
df_citing_publications <- read_csv(here("data", "citing_publications", 
                                        glue("{params$project_name}_citing_pubs_details.csv")), 
                                   show_col_types = FALSE)

df_citers <- read_csv(here("data", "citing_publications",
                           glue("{params$project_name}_citing_pubs_citers.csv")), 
                      show_col_types = FALSE) %>%
  distinct(publication_id, country, name, types)
```

```{r data-citing-publications}
n_unique_citing_publications <- n_distinct(df_citing_publications$publication_id)
```

Research outputs published by researchers form the `r params$research_unit` was cited in *`r n_unique_citing_publications`* journals and Table \@ref(tab:tbl-citing-journals) shows the number of citations for each journal. Figure \@ref(fig:fig-citing-publishers) breaks down the number of citations by publisher.

```{r tbl-citing-journals}
df_citing_journals <- citing_journals(df_citing_publications, k = 25)

knitr::kable(df_citing_journals, align = "cl", 
             booktabs = TRUE, linesep = "\\addlinespace", longtable = TRUE,
             caption = glue("Number of citing publications in the top 25 journals referencing research outputs produced by researchers from the {params$research_unit}, {params$min_year} to {params$max_year}.")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position", "repeat_header")) %>%
  kableExtra::column_spec(1, width = "5em") %>%
  kableExtra::column_spec(2, width = "40em")
```

```{r fig-citing-publishers, fig.align='center', fig.pos='H', fig.width=6, fig.height=8, fig.cap=glue("Number of citing publications by publisher referencing research outputs produced by researchers from the {params$research_unit}, {params$min_year} to {params$max_year}. Only the top 20 publishers are shown.")}
citations_by_publisher(df_citing_publications, k = 20, discrete_pal)
```

```{r data-citers-stats}
citers_summary_results <- citers_summary(df_citers)

n_unique_citing_countries <- citers_summary_results$n_unique_citing_countries
n_unique_citing_organisations <- citers_summary_results$n_unique_citing_organisations
n_nas_countries <- citers_summary_results$n_nas_countries
df_citing_countries <- citers_summary_results$df_citing_countries
```

\newpage

Figure \@ref(fig:map-citing-countries) shows the number of citing publications from different countries. An output with authors from multiple countries is counted *once* for each country. Outputs with multiple authors from the same country are *not* counted once for each author; they are counted once for each country only.

```{r map-citing-countries, fig.align='center', fig.pos='H', fig.width = 6, fig.cap=glue("The geographical distribution of research organisations citing research outputs produced by the {params$research_unit}, {params$min_year} - {params$max_year}.")}
world <- world_map_data()
map_citing_countries <- left_join(world, df_citing_countries, by = "region") %>% 
  filter(region != "Antarctica")
# TODO add parameters when function gets updated to account for different uses of the map
world_map_plot(map_citing_countries, params$palette, scale_name = "Citing publications")
```

\newpage

Figure \@ref(fig:fig-citing-orgs) shows the organisations that cite research by the `r params$research_unit` most frequently. Figure \@ref(fig:fig-citing-types) breaks down the citing organisations by type of organisation. An output with authors from multiple organisations is counted *once* for each organisation. Outputs with multiple authors from the same organisation are *not* counted once for each author; they are counted once for each organisation only.

```{r fig-citing-orgs, fig.align='center', fig.pos='H', fig.height=4, fig.width=6, fig.cap=glue("Research organisations most frequently citing research outputs produced by researchers fro the {params$research_unit}, {params$min_year} - {params$max_year}.")}
citing_orgs(df_citers, k = 10, discrete_pal)
```

```{r fig-citing-types, fig.align='center', fig.pos='H', fig.width=5, fig.cap=glue("Types of organisation citing research outputs by researchers from the {params$research_unit}, {params$min_year} - {params$max_year}.")}
citing_org_types(df_citers, discrete_pal, 
                 label_colours = c("black", rep("white", 3), rep("black", 3)))
```

\newpage

# Collaboration

This section looks at collaborations between researchers in the `r params$research_unit` and researchers at other organisations, providing an overview of the different types of collaborations, collaborations with UK and international partners, and collaborations with education and non-educational partners.

```{r load-collab-data}
research_organisations <- read_csv(here("data", 
                                        glue("{params$project_name}_research_organisations.csv")),
                                   show_col_types = FALSE) %>% 
  filter(type != "preprint")

research_organisations <- research_organisations %>%
  group_by(publication_id) %>%
  mutate(collaboration = ifelse(length(organisation_name) == 1, "Single authored",
                                ifelse(n_distinct(organisation_name) == 1, "Institutional co-authored", 
                                       ifelse(n_distinct(country_name) == 1, "National collaboration", 
                                              "International collaboration")))) %>%
  ungroup()

research_organisations$collaboration <- factor(research_organisations$collaboration, 
                                                 levels = c("Single authored",
                                                            "Institutional co-authored",
                                                            "National collaboration",
                                                            "International collaboration"))
```

```{r collab-type-summary}
collaboration_summary_results <- collaboration_summary(research_organisations)

df_types_of_collaboration <- collaboration_summary_results$df_types_of_collaboration
p_collaboration <- collaboration_summary_results$p_collaboration
```

```{r collab-countries-summary}
countries_collab_summary_results <- countries_collab_summary(research_organisations)

collaboration_countries <- countries_collab_summary_results$collaboration_countries
df_collaborating_countries <- countries_collab_summary_results$df_collaborating_countries
n_collaborating_countries <- countries_collab_summary_results$n_collaborating_countries
max_country <- countries_collab_summary_results$max_country
```

```{r collab-orgs-summary}
orgs_collab_summary_results <- collaborating_orgs_summary(research_organisations)

unique_organisations <- orgs_collab_summary_results$unique_organisations
n_unique_collaborators <- orgs_collab_summary_results$n_unique_collaborators
n_publications_with_non_educational_collaborators <- orgs_collab_summary_results$n_publications_with_non_educational_collaborators
p_publications_with_non_educational_collaborators <- orgs_collab_summary_results$p_publications_with_non_educational_collaborators
n_non_educational_collaborators <- orgs_collab_summary_results$n_non_educational_collaborators
outputs_in_sample_by_type_of_collaborator <- orgs_collab_summary_results$outputs_in_sample_by_type_of_collaborator
df_types_of_collaborators <- orgs_collab_summary_results$df_types_of_collaborators
```

## Key stats

```{r fig-collab-stats, fig.align='center'}
collab_key_stats <- tibble(
  x = c(2, 8.5, 2, 8.5),
  y = c(11, 11, 6.5, 6.5),
  h = c(4.25, 4.25, 4.25, 4.25),
  w = c(6.25, 6.25, 6.25, 6.25),
  values = as.character(c(round(p_collaboration, 0),
                          n_collaborating_countries,
                          n_unique_collaborators,
                          round(p_publications_with_non_educational_collaborators, 0))),
  text = c("Outputs arising from\ncollaborations",
           "Collaborating countries\n",
           "Collaborating\norganisations",
           "Outputs with\nnon-academic partners"),
  colour = factor(c(1, 2, 3, 4))) %>%
  mutate(values = ifelse(text %in% text[c(1, 4)],
                         glue("{values}%"),
                         values))

key_stats_plot(collab_key_stats, discrete_pal) +
  labs(caption = str_wrap("Collaboration refers to outputs where at least one author is not from the University of Bradford.", width = 80)) 
```

\newpage

## Types of collaboration

Research outputs produced by the `r params$research_unit` are broken down into four types of research collaboration:

- Single authored: a research output with a single author from the University of Bradford.
- Institutional co-authored: a research output with multiple authors from the University of Bradford.
- National collaboration: a research output with at least one co-author from another research organisation based in the UK.
- International collaboration: a research output with at least one co-author from another research organisation based outside the UK.

From Table \@ref(tab:tbl-collab-types) we see that single authored papers account for only a small percentage of the total number of research outputs from the `r params$research_unit`. There are no outputs classed as being institutionally co-authored, indicating that all outputs with more than author from the University of Bradford also have at least one co-author from another research organisation, based either in the UK or beyond. Figure \@ref(fig:fig-collab-summary) breaks down the collaboration types by year and Figure \@ref(fig:fig-collab-cumulative-types) shows the cumulative trend in research outputs by collaboration type.

```{r tbl-collab-types}
knitr::kable(df_types_of_collaboration, align = "lcc", 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Number of research outputs for each type of collaboration with researchers from the {params$research_unit}, {params$min_year} to {params$max_year}.")) %>%
  kableExtra::kable_styling(font_size = 10, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position"))
```


\newpage

```{r fig-collab-summary, fig.align='center', fig.width = 6, fig.height = 3.5, fig.pos='H', fig.cap=glue("Research outputs by collaboration type for the {params$research_unit}, {params$min_year} - {params$max_year}.")}
collab_summary_figures <- collab_summary_plots(research_organisations, discrete_pal)
collab_summary_figures$collab_type_plot
```

\bigskip

```{r fig-collab-cumulative-types, fig.align='center', fig.width = 6, fig.height = 3.5, fig.pos='H', fig.cap=glue("Cumualtive research outputs by collaboration type for the {params$research_unit}, {params$min_year} - {params$max_year}.")}
collab_summary_figures$collab_type_cum
```

\newpage

## Countries

Researchers in the `r params$research_unit` have collaborated with researchers from organisations in **`r n_collaborating_countries` different countries**.

Figure \@ref(fig:fig-top-k-countries) presents the top ranked countries by number of collaborations with the `r params$research_unit`. With `r max(df_collaborating_countries$frequency)`, the **`r max_country`** is the main source of research collaborations, and Figure \@ref(fig:fig-map-collab) maps the total number of collaborations across the globe. 

\medskip

```{r fig-top-k-countries, fig.align='center', fig.width = 6, fig.cap=glue("Top 15 most collaborative countries with the {params$research_unit}, {params$min_year} - {params$max_year}.")}
collab_countries_figures <- collab_countries_plots(df_collaborating_countries, discrete_pal, k = 15)
collab_countries_figures$collab_countries_barplot
```

```{r fig-map-collab, fig.align='center', fig.width = 6, fig.cap=glue("The geographical distribution of research organisations collaborating with the {params$research_unit}, {params$min_year} - {params$max_year}.")}
world <- world_map_data()
map_collab_countries <- left_join(world, df_collaborating_countries, by = "region") %>% 
  filter(region != "Antarctica")
world_map_plot(map_collab_countries, params$palette, scale_name = "Collaborations")
```

\newpage

## Organisations

Researchers in the `r params$research_unit` collaborated with researchers at **`r n_unique_collaborators`** research organisations. (This number includes the Wolfson Centre for Applied Health Research as a joint venture between the University of Bradford, Bradford Teaching Hospitals NHS Trust, and the University of Leeds). Figure \@ref(fig:fig-top-orgs) shows the top 15 organisations with the most collaborations with researchers from the University of Bradford.

\smallskip

```{r collab-orgs-figures}
collab_orgs_figures <- collab_orgs_plots(research_organisations, unique_organisations, discrete_pal, k = 15)
```

```{r fig-top-orgs, fig.align='center', fig.width = 6, fig.height = 6, fig.pos='H', fig.cap = glue("The top 15 organisations collaborating with the {params$research_unit} by output volume, {params$min_year} - {params$max_year}.")}
collab_orgs_figures$top_k_orgs_plot
```

\newpage

Figure \@ref(fig:fig-orgs-types) shows the frequencies of the different types of research organisations to collaborate with researchers from `r params$research_unit` from `r params$min_year` to `r params$max_year`. Table \@ref(tab:tbl-non-ed-collab) summarises the number of outputs in the result set by the type of collaborating research organisation. Figure \@ref(fig:fig-outputs-orgs) shows the number of research outputs produced in collaboration with different types of research organisations in each year covered by the result set, and Figure \@ref(fig:fig-cumulative-type) shows the cumulative number of collaborations for each type of research organisation.

\medskip

```{r fig-orgs-types, fig.align='center', fig.width = 5, fig.height=3.5, fig.pos='H', fig.cap=glue("Types of research organisations collaborating with the {params$research_unit} by organisation type, {params$min_year} - {params$max_year}.")}
collab_orgs_figures$collab_org_types_plot
```

```{r tbl-non-ed-collab}
knitr::kable(outputs_in_sample_by_type_of_collaborator, align = "lcc", 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Number of research outputs for each type of organisation collaborating with researchers from the {params$research_unit}, {params$min_year} to {params$max_year}. Please note that an output may be counted multiple times where co-authors were from more than one type of organisation.")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position"))
```

\bigskip

```{r fig-outputs-orgs, fig.align='center', fig.width = 6, fig.height = 3.5, fig.pos='H', fig.cap=glue("The number of research outputs by organisation type for research organisations collaborating with the {params$research_unit}, {params$min_year} - {params$max_year}.")}
collab_orgs_figures$outputs_by_org_type_plot
```

```{r fig-cumulative-type, fig.align='center', fig.width = 6, fig.height = 3.5, fig.pos='H', fig.cap=glue("The cumulative number of collaborations by organisation type for research organisations collaborating with the {params$research_unit}, {params$min_year} - {params$max_year}.")}
collab_orgs_figures$cum_outputs_by_org_type_plot
```

### Collaborations with educational research organisations

```{r data-educational-collab}
educational_collab_results <- educational_collab_summary(research_organisations)

n_educational_collaborators <- educational_collab_results$n_educational_collaborators
n_uk_educational_collaborators <- educational_collab_results$n_uk_educational_collaborators
n_int_educational_collaborators <- educational_collab_results$n_int_educational_collaborators
uk_educational_collab <- educational_collab_results$uk_educational_collab
int_educational_collab <- educational_collab_results$int_educational_collab
```

Researchers from the `r params$research_unit` collaborated with **`r n_educational_collaborators`** educational research organisations on `r n_publications_with_non_educational_collaborators` research outputs from `r params$min_year` to `r params$max_year`. Of these, **`r n_uk_educational_collaborators`** were based in the United Kingdom and **`r n_int_educational_collaborators`** were based outside the UK.

Table \@ref(tab:tbl-uk-ed) presents the number of outputs for each UK-based educational research organisation produced in collaboration with researchers from the `r params$research_unit`. Table \@ref(tab:tbl-int-ed) presents the number of outputs for each educational research organisation based outside the UK produced in collaboration with researchers from the `r params$research_unit`.

```{r tbl-uk-ed}
knitr::kable(uk_educational_collab, align = "cl", 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Number of research outputs for each UK-based educational research organisation collaborating with researchers from the {params$research_unit}, {params$min_year} to {params$max_year}. Please note that an output may be counted multiple times where co-authors were from more than one of organisation.")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position")) %>%
  kableExtra::column_spec(2, width = "40em")
```

```{r tbl-int-ed}
knitr::kable(int_educational_collab, align = "cl", 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Number of research outputs for each educational research organisation based outside the UK collaborating with researchers from the {params$research_unit}, {params$min_year} to {params$max_year}. Please note that an output may be counted multiple times where co-authors were from more than one of organisation. Only research organisations with two or more outputs are shown.")) %>%
  kableExtra::kable_styling(font_size = 9.5, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position")) %>%
  kableExtra::column_spec(2, width = "40em")
```

\newpage

### Collaborations with non-educational research organisations

```{r data-non-ed-collab}
non_ed_collab_results <- non_ed_collab_summary(research_organisations, discrete_pal,
                                               unique_organisations)

n_uk_non_educational_collaborators <- non_ed_collab_results$n_uk_non_educational_collaborators
n_int_non_educational_collaborators <- non_ed_collab_results$n_int_non_educational_collaborators
```

Researchers from the `r params$research_unit` collaborated with **`r n_non_educational_collaborators` non-educational research organisations** on `r n_publications_with_non_educational_collaborators` research outputs from `r params$min_year` to `r params$max_year`, so that a total of **`r p_publications_with_non_educational_collaborators`%** of research outputs have at least one researcher from non-educational research organisation listed as a co-author. Figure \@ref(fig:fig-outputs-int-orgs) shows the number of research outputs produced in collaboration with **`r n_int_non_educational_collaborators`** non-educational research organisations based outside the UK. 

\medskip

```{r fig-outputs-int-orgs, fig.align='center', fig.width = 6, fig.height = 6, fig.pos='H', fig.cap=glue("The number of research outputs by organisation type for international non-educational research organisations collaborating with the {params$research_unit}, {params$min_year} - {params$max_year}.")}
df_int_non_edu_collab <- non_ed_collab_results$df_int_non_edu_collab
non_ed_orgs_plot(df_int_non_edu_collab, discrete_pal)
```

\newpage

Figure \@ref(fig:fig-outputs-UK-orgs) shows the number of research outputs produced in collaboration with **`r n_uk_non_educational_collaborators`** non-educational research organisations based in the UK. 

\medskip

```{r fig-outputs-UK-orgs, fig.align='center', fig.pos='H', fig.width = 6, fig.height = 6.5, fig.cap=glue("The number of research outputs by researchers in the {params$research_unit} collaborating with UK-based non-educational research organisations, {params$min_year} - {params$max_year}.")}
df_uk_orgs <- non_ed_collab_results$df_uk_orgs
non_ed_orgs_plot(df_uk_orgs, discrete_pal)
```

\newpage

# Altmetrics

[Altmetrics](https://www.altmetric.com/) (Alternative metrics) are a way of measuring the attention received research by tracking its online activity and engagement across social media channels (e.g. Twitter, Facebook), news media, websites (e.g. Wikipedia), post-publication peer-review channels, and policy documents. Data on Mendeley readers is also captured.

This section presents an overview of the online attention received by research outputs produced by researchers in the `r params$research_unit`. 

```{r data-altmetrics}
df_altmetrics <- read_csv(here("data", glue("{params$project_name}_altmetric_details.csv")),
                          show_col_types = FALSE) %>%  
  distinct(doi, .keep_all = TRUE) %>%
  arrange(desc(Altmetric)) %>%
  mutate(rank = rank(-Altmetric, ties.method = "min")) %>%
  relocate(rank)

pubs <- df_publications %>%
  select(-researcher_id) %>%
  distinct(doi, .keep_all = TRUE)

df_altmetrics <- inner_join(df_altmetrics, pubs, by = "doi") %>% 
  mutate(open_access = str_to_title(open_access))
```

```{r altmetrics-summary}
altmetrics_results <- altmetrics_summary(df_altmetrics)

n_outputs_with_altmetric_score <- altmetrics_results$n_outputs_with_altmetric_score
altmetric_scores_summary <- altmetrics_results$altmetric_scores_summary
```

```{r altmetric-types}
altmetrics_types_results <- altmetric_types(df_altmetrics, n_unique_outputs)

n_outputs_in_news <- altmetrics_types_results$n_outputs_in_news
n_mentions_in_news <- altmetrics_types_results$n_mentions_in_news
n_outputs_in_policy_docs <- altmetrics_types_results$n_outputs_in_policy_docs
n_mentions_in_policy_docs <- altmetrics_types_results$n_mentions_in_policy_docs
altmetric_summary <- altmetrics_types_results$altmetric_summary %>% rename_with(str_to_title)
```

## Key stats

```{r fig-altmetric-stats, fig.align='center'}
altmetric_key_stats <- tibble(
  x = c(2, 8.5, 2, 8.5),
  y = c(11, 11, 6.5, 6.5),
  h = c(4.25, 4.25, 4.25, 4.25),
  w = c(6.25, 6.25, 6.25, 6.25),
  values = as.character(c(n_outputs_with_altmetric_score,
                          altmetric_scores_summary$median,
                          n_mentions_in_news,
                          n_outputs_in_policy_docs)),
  text = c("Outputs receiving\nattention online",
           "Median Altmetric score\n",
           "Mentions in\nnews media",
           "Outputs mentioned in\npolicy documents"),
  colour = factor(c(1, 2, 3, 4)))

key_stats_plot(altmetric_key_stats, discrete_pal)
```

## Altmetric scores

The Altmetric score is a high-level measure of the online attention for an output and is calculated as the weighted sum of the different types of attention received, so that a mention in a policy document makes a greater contribution to the score than a single tweet, for example. Altmetric scores are calculated on the last date an output was mentioned. The number of Mendeley readers is not included in calculating the Altmetric score.

A total of **`r n_outputs_with_altmetric_score`** outputs have an Altmetric score. Figure \@ref(fig:fig-altmetric-bar) plots the distribution of Altmetric scores for outputs in the result set. The median Altmetric score for outputs produced by researchers in the `r params$research_unit` is `r altmetric_scores_summary$median`, with a range of `r altmetric_scores_summary$min` to `r altmetric_scores_summary$max`.

```{r fig-altmetric-bar, fig.align='center', fig.pos='H', fig.width=6, fig.height=4, fig.cap=glue("The distribution of Altemtric scores for outputs produced by researchers from the {params$research_unit}, {params$min_year} - {params$max_year}. Please note: not all outputs have an Altmetric score.")}
altmetrics_plot(df_altmetrics, discrete_pal)
```

Table \@ref(tab:tbl-altmetric-summary) breaks down research outputs by channel of online attention, showing the number of outputs produced by researchers from the `r params$research_unit` that received attention via a particular channel and the total number of mentions received via that channel. Research outputs received attention across a total of `r dim(altmetric_summary)[1] - 1` different channels of attention, excluding Mendeley readers.

A total of **`r n_outputs_in_news`** outputs received **`r n_mentions_in_news`** mentions in mainstream news media.

A total of **`r n_outputs_in_policy_docs`** outputs were mentioned in policy documents for a total of **`r n_mentions_in_policy_docs`** mentions.

```{r tbl-altmetric-summary}
knitr::kable(altmetric_summary, align = "lccc", 
             booktabs = TRUE, linesep = "\\addlinespace",
             caption = glue("Online attention of research outputs produced by researchers from the {params$research_unit}, {params$min_year} to {params$max_year}, broken down by the number and percentage of outputs in the result set receiving attention via a speciifc channel and the total number of mentions across mentioned outputs.")) %>%
  kableExtra::kable_styling(font_size = 10, full_width = FALSE, 
                            latex_options = c("striped", "HOLD_position"))
```

```{r data-altmetrics-context}
altmetric_context_results <- altmetrics_context(df_altmetrics, discrete_pal)
  
outputs_with_altmetric_context <- altmetric_context_results$outputs_with_altmetric_context
altmetric_context_data_summary <- altmetric_context_results$altmetric_context_data_summary
```

The Altmetric score for a target output can be contextualised by comparing its score to those of *all* outputs published in the same source (e.g., in the same journal) and those outputs published in that source within a three month window comprising the six weeks before and the six weeks after the target output's date of publication. The percentile rank of a target output's Altmetric score can then be determined. Contextual data is available for `r outputs_with_altmetric_context` outputs, and the percentile ranks are shown in Figure \@ref(fig:fig-altmetric-context).

```{r fig-altmetric-context, fig.align='center', fig.pos='H', fig.width=6, fig.height=3.5, fig.cap=glue("The context of research outputs produced by {params$research_unit}, {params$min_year} - {params$max_year}, based on Altmetric percentiles.")}
altmetric_context_results$altmetric_context_distribution
```

The median percentile when comparing outputs produced by researchers from the `r params$research_unit` to all other outputs in their respective sources is `r altmetric_context_data_summary$median[1]`, with a range of `r altmetric_context_data_summary$min[1]` to `r altmetric_context_data_summary$max[1]`. 

The median percentile when comparing outputs produced by researchers from the `r params$research_unit` to outputs in their respective sources of the same age is `r altmetric_context_data_summary$median[2]`, with a range of `r altmetric_context_data_summary$min[2]` to `r altmetric_context_data_summary$max[2]`.

\newpage

# Research Outputs

:::refs
:::
